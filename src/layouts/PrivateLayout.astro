---
import CoreLayout from "./CoreLayout.astro";
import Background from "../components/layout/Background.astro";
import AdminSidebar from "../components/admin/AdminSidebar.astro";
import AdminNavbar from "../components/admin/AdminNavbar.astro";
import UnsavedChangesModal from "../components/ui/UnsavedChangesModal.astro";
import ConfirmModal from "../components/ui/ConfirmModal.astro";

interface Props {
    title?: string;
    description?: string;
}

const { title, description } = Astro.props;
---

<CoreLayout title={title} description={description}>
    <Background />
    <div class="flex min-h-screen relative z-10">
        <!-- Sidebar -->
        <AdminSidebar />

        <!-- Main content -->
        <main
            class="admin-main flex-grow flex flex-col min-w-0 transition-all duration-300"
        >
            <!-- Topbar -->
            <AdminNavbar />

            <div class="flex-grow p-6 overflow-y-auto">
                <slot />
            </div>
        </main>

        <UnsavedChangesModal />
        <ConfirmModal />
    </div>
</CoreLayout>

<style>
    .admin-main {
        margin-left: 0;
    }
    @media (min-width: 768px) {
        .admin-main {
            margin-left: 16rem;
        }
        :root[data-admin-sidebar="open"] .admin-main {
            margin-left: 16rem;
        }
        :root[data-admin-sidebar="minimized"] .admin-main {
            margin-left: 5rem;
        }
        :root[data-admin-sidebar="closed"] .admin-main {
            margin-left: 0;
        }
    }
</style>

<script>
    import { authService } from "../lib/auth";

    const redirectToLogin = () => {
        if (!authService.isAuthenticated()) {
            window.location.replace("/login");
        }
    };

    redirectToLogin();
    window.addEventListener("pageshow", () => {
        redirectToLogin();
    });
</script>
