---
import PrivateLayout from "../../layouts/PrivateLayout.astro";
import { systemService } from "../../lib/system";

const logs = await systemService.getLogs();
const recentLogs = logs.slice(0, 5);

// Mock Data
const stats = [
  {
    label: "Total Visits",
    value: "12,453",
    change: "+12%",
    color: "text-cyan-400",
  },
  {
    label: "Active Projects",
    value: "9",
    change: "0%",
    color: "text-green-400",
  },
  { label: "Messages", value: "24", change: "+4", color: "text-yellow-400" },
  {
    label: "System Status",
    value: "98%",
    change: "Optimal",
    color: "text-blue-400",
  },
];
---

<PrivateLayout title="Dashboard | Hafiz.dev">
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
    {
      stats.map((stat) => (
        <div class="bg-gray-800/50 backdrop-blur-sm border border-white/5 p-6 rounded-xl hover:bg-gray-800/70 transition-colors group">
          <h3 class="text-gray-400 text-sm font-medium">{stat.label}</h3>
          <div class="mt-2 flex items-baseline justify-between">
            <span class="text-2xl font-bold text-white">{stat.value}</span>
            <span
              class={`text-xs font-mono px-2 py-1 rounded-full bg-gray-900 ${stat.color}`}
            >
              {stat.change}
            </span>
          </div>
          <div class="mt-4 h-1 w-full bg-gray-700 rounded-full overflow-hidden">
            <div
              class={`h-full bg-current opacity-50 ${stat.color.replace("text", "bg")} w-2/3 group-hover:w-full transition-all duration-500`}
            />
          </div>
        </div>
      ))
    }
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
    <!-- Main Chart Area (Placeholder) -->
    <div
      class="lg:col-span-2 bg-gray-800/50 backdrop-blur-sm border border-white/5 rounded-xl p-6 min-h-[400px]"
    >
      <div class="flex items-center justify-between mb-6">
        <h2 class="text-lg font-bold text-white">Traffic Overview</h2>
        <select
          class="bg-gray-900 border border-gray-700 text-gray-300 text-sm rounded-lg p-2 focus:ring-cyan-500 focus:border-cyan-500"
        >
          <option>Last 7 Days</option>
          <option>Last 30 Days</option>
          <option>This Year</option>
        </select>
      </div>

      <!-- Chart Visual Placeholder -->
      <div
        class="relative h-64 w-full flex items-end justify-between gap-2 px-4"
      >
        {
          [40, 65, 45, 80, 55, 90, 70].map((height) => (
            <div class="w-full bg-gray-700/30 rounded-t-sm relative group">
              <div
                class="absolute bottom-0 left-0 w-full bg-cyan-500/50 group-hover:bg-cyan-400 transition-all duration-300"
                style={`height: ${height}%`}
              >
                <div class="opacity-0 group-hover:opacity-100 absolute -top-8 left-1/2 transform -translate-x-1/2 bg-gray-900 text-white text-xs py-1 px-2 rounded border border-white/10 whitespace-nowrap z-10">
                  {height * 10} visits
                </div>
              </div>
            </div>
          ))
        }
      </div>
      <div
        class="flex justify-between text-xs text-gray-500 mt-4 px-2 font-mono"
      >
        <span>Mon</span><span>Tue</span><span>Wed</span><span>Thu</span><span
          >Fri</span
        ><span>Sat</span><span>Sun</span>
      </div>
    </div>

    <!-- Quick Actions -->
    <div
      class="bg-gray-800/50 backdrop-blur-xl border border-gray-700 rounded-xl p-6"
    >
      <h3 class="text-lg font-bold text-white mb-4">Quick Actions</h3>
      <div class="grid grid-cols-2 gap-4">
        <a
          href="/admin/projects/new"
          class="flex flex-col items-center justify-center p-4 bg-gray-900/50 rounded-lg hover:bg-cyan-900/20 hover:border-cyan-500/50 border border-transparent transition-all group"
        >
          <svg
            class="w-6 h-6 text-cyan-400 mb-2 group-hover:scale-110 transition-transform"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M12 4v16m8-8H4"></path>
          </svg>
          <span class="text-sm text-gray-300 group-hover:text-white"
            >New Project</span
          >
        </a>
        <a
          href="/admin/system"
          class="flex flex-col items-center justify-center p-4 bg-gray-900/50 rounded-lg hover:bg-purple-900/20 hover:border-purple-500/50 border border-transparent transition-all group"
        >
          <svg
            class="w-6 h-6 text-purple-400 mb-2 group-hover:scale-110 transition-transform"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
            ></path>
          </svg>
          <span class="text-sm text-gray-300 group-hover:text-white"
            >System Logs</span
          >
        </a>
      </div>
    </div>

    <!-- Recent System Logs -->
    <div
      class="bg-gray-800/50 backdrop-blur-xl border border-gray-700 rounded-xl p-6 lg:col-span-3"
    >
      <div class="flex items-center justify-between mb-6">
        <h3 class="text-lg font-bold text-white">Recent System Logs</h3>
        <a
          href="/admin/system"
          class="text-sm text-cyan-400 hover:text-cyan-300 transition-colors"
          >View All</a
        >
      </div>
      <div class="space-y-4">
        {
          recentLogs.map((log) => (
            <div class="flex items-start gap-4 p-3 bg-gray-900/30 rounded-lg border border-gray-700/50 hover:bg-gray-800/50 transition-colors">
              <div
                class={`mt-1 w-2 h-2 rounded-full shrink-0 ${
                  log.level === "error"
                    ? "bg-red-500 shadow-[0_0_8px_rgba(239,68,68,0.6)]"
                    : log.level === "warning"
                      ? "bg-yellow-500 shadow-[0_0_8px_rgba(234,179,8,0.6)]"
                      : "bg-green-500 shadow-[0_0_8px_rgba(34,197,94,0.6)]"
                }`}
              />
              <div class="flex-grow min-w-0">
                <div class="flex items-center justify-between gap-2 mb-1">
                  <span class="text-xs font-mono text-cyan-400 bg-cyan-900/20 px-1.5 py-0.5 rounded border border-cyan-900/50">
                    {log.source}
                  </span>
                  <span class="text-xs text-gray-500 font-mono">
                    {new Date(log.timestamp).toLocaleString()}
                  </span>
                </div>
                <p class="text-sm text-gray-300 truncate">{log.message}</p>
              </div>
            </div>
          ))
        }
        {
          recentLogs.length === 0 && (
            <p class="text-sm text-gray-500 text-center py-4">
              No recent logs found.
            </p>
          )
        }
      </div>
    </div>
  </div>
</PrivateLayout>
